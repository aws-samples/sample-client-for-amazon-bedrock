name: "test-api-key-notarization"

on:
  workflow_dispatch:

jobs:
  test-api-notarization:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Test App Store Connect API Key Notarization
        env:
          APPLE_API_KEY: ${{ secrets.APPLE_API_KEY }}
          APPLE_API_KEY_ID: ${{ secrets.APPLE_API_KEY_ID }}
          APPLE_API_ISSUER: ${{ secrets.APPLE_API_ISSUER }}
        run: |
          echo "🔍 检查是否配置了 App Store Connect API 密钥..."
          
          if [ -z "$APPLE_API_KEY" ] || [ -z "$APPLE_API_KEY_ID" ] || [ -z "$APPLE_API_ISSUER" ]; then
            echo "❌ App Store Connect API 密钥未配置"
            echo ""
            echo "📋 需要在 Apple Developer 账户中创建 API 密钥："
            echo "1. 访问 https://appstoreconnect.apple.com/access/api"
            echo "2. 点击 'Keys' 标签"
            echo "3. 点击 '+' 创建新密钥"
            echo "4. 选择 'Developer' 角色"
            echo "5. 下载 .p8 文件"
            echo "6. 记录 Key ID 和 Issuer ID"
            echo ""
            echo "📝 然后在 GitHub Secrets 中设置："
            echo "- APPLE_API_KEY: .p8 文件的内容"
            echo "- APPLE_API_KEY_ID: 密钥 ID (10个字符)"
            echo "- APPLE_API_ISSUER: Issuer ID (UUID 格式)"
            echo ""
            echo "🔗 参考文档: https://developer.apple.com/documentation/appstoreconnectapi/creating_api_keys_for_app_store_connect_api"
            exit 1
          else
            echo "✅ App Store Connect API 密钥已配置"
            echo "Key ID: $APPLE_API_KEY_ID"
            echo "Issuer: $APPLE_API_ISSUER"
            echo "API Key length: ${#APPLE_API_KEY} characters"
          fi
