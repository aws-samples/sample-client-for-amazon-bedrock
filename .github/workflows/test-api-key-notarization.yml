name: "test-api-key-notarization"

on:
  workflow_dispatch:

jobs:
  test-api-notarization:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Test App Store Connect API Key Notarization
        env:
          APPLE_API_KEY: ${{ secrets.APPLE_API_KEY }}
          APPLE_API_KEY_ID: ${{ secrets.APPLE_API_KEY_ID }}
          APPLE_API_ISSUER: ${{ secrets.APPLE_API_ISSUER }}
        run: |
          echo "ğŸ” æ£€æŸ¥æ˜¯å¦é…ç½®äº† App Store Connect API å¯†é’¥..."
          
          if [ -z "$APPLE_API_KEY" ] || [ -z "$APPLE_API_KEY_ID" ] || [ -z "$APPLE_API_ISSUER" ]; then
            echo "âŒ App Store Connect API å¯†é’¥æœªé…ç½®"
            echo ""
            echo "ğŸ“‹ éœ€è¦åœ¨ Apple Developer è´¦æˆ·ä¸­åˆ›å»º API å¯†é’¥ï¼š"
            echo "1. è®¿é—® https://appstoreconnect.apple.com/access/api"
            echo "2. ç‚¹å‡» 'Keys' æ ‡ç­¾"
            echo "3. ç‚¹å‡» '+' åˆ›å»ºæ–°å¯†é’¥"
            echo "4. é€‰æ‹© 'Developer' è§’è‰²"
            echo "5. ä¸‹è½½ .p8 æ–‡ä»¶"
            echo "6. è®°å½• Key ID å’Œ Issuer ID"
            echo ""
            echo "ğŸ“ ç„¶ååœ¨ GitHub Secrets ä¸­è®¾ç½®ï¼š"
            echo "- APPLE_API_KEY: .p8 æ–‡ä»¶çš„å†…å®¹"
            echo "- APPLE_API_KEY_ID: å¯†é’¥ ID (10ä¸ªå­—ç¬¦)"
            echo "- APPLE_API_ISSUER: Issuer ID (UUID æ ¼å¼)"
            echo ""
            echo "ğŸ”— å‚è€ƒæ–‡æ¡£: https://developer.apple.com/documentation/appstoreconnectapi/creating_api_keys_for_app_store_connect_api"
            exit 1
          else
            echo "âœ… App Store Connect API å¯†é’¥å·²é…ç½®"
            echo "Key ID: $APPLE_API_KEY_ID"
            echo "Issuer: $APPLE_API_ISSUER"
            echo "API Key length: ${#APPLE_API_KEY} characters"
          fi
